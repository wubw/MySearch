
- [BigFunnelDeepDiveJuly2022.pptx](https://microsoft.sharepoint.com/:p:/r/teams/BFExE/_layouts/15/Doc.aspx?sourcedoc=%7B669B6D17-F2EE-4CC1-8101-0AC78A0390EB%7D&file=BigFunnelDeepDiveJuly2022.pptx&action=edit&mobileredirect=true&share=IQEXbZtm7vLBTIEBCseKA5DrAdJb3yQHzKkxnJPi7-h2r_Y&xsdata=MDV8MDF8fDc5NmUxN2JhNWNhMjRhZmFjOTkxMDhkYmNlZmNkZDk2fDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2MzgzMzEzNTc2NDc3ODQzMzd8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZUa1JWTlU1Nlp6Rk5WMDEwVFZSbk1GcHBNREJQUkdzMFRGZEdhMDVIUlhSYVZHTXhUbGRhYWsxNlZYZFBSR3Q1UUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE5qazNOVE00T1RRME5qVXp8ZWM4YTliMWVkOGRjNDQ4ZWM5OTEwOGRiY2VmY2RkOTZ8YWZhODFkMmI4YjgwNGVlZGFmMGE4NTYwN2RjMzkxNGI%3D&sdata=OGYrWmVxZndoUEdBd1dwVTVYZ3FEU0crQTBsdDlVcE9OeXVSWmRVN3pJOD0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Cbinweiwu%40microsoft.com "https://microsoft.sharepoint.com/:p:/r/teams/bfexe/_layouts/15/doc.aspx?sourcedoc=%7b669b6d17-f2ee-4cc1-8101-0ac78a0390eb%7d&file=bigfunneldeepdivejuly2022.pptx&action=edit&mobileredirect=true&share=iqexbztm7vlbtiebcseka5dradjb3yqhzkkxnjpi7-h2r_y&xsdata=mdv8mdf8fdc5nmuxn2jhnwnhmjrhzmfjotkxmdhkymnlzmnkzdk2fdcyzjk4ogjmodzmmtqxywy5mwfimmq3y2qwmtfkyjq3fdb8mhw2mzgzmzezntc2ndc3odqzmzd8vw5rbm93bnxwr1zoylhovfpxtjfjbwwwzvzobgnuwnbzmly4zxlkv0lqb2lnqzr3tgpbd01eqwlmq0prswpvavyybhvneklptenkqlrpstzjazkwyudweulpd2lwmvfpt2pfegzrpt18mxxmmk5vwvhsekx6rtvpbtfswlhscgjtzgzua1jwtlu1nlp6rk5wmdewvfzsbk1gchbnrejqukdzmfrgzedhmdviulhsyvzhtxhubgrhywsxnlzyzfbsr3q1uuhsb2ntvmhaqzuytwk5dfpytnpzv2rsy3k4ee5qaznove00t1rrme5qvxp8zwm4ytlimwvkogrjndq4zwm5otewogriy2vmy2rkotz8ywzhodfkmmi4yjgwngvlzgfmmge4ntywn2rjmzkxngi%3d&sdata=ogyrwmvxzndouedbd1dwvtvyz3feu0crqtbsddlvce9oexvswmrvn3pjod0%3d&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2cbinweiwu%40microsoft.com")
The BigFunnel Filter table is part of the BigFunnel sub-system and plays a crucial role in optimizing search query performance. It uses a bloom filter bit-vector data structure to efficiently eliminate non-matching documents during query evaluation. Each record in the Filter table corresponds to a specific item or document in the ItemStore, and the table is ordered by document ID. The bloom filter represents all unique unigram terms in a document, and potentially some or all higher n-gram terms, based on performance tuning. This helps reduce CPU usage by quickly filtering out documents that do not match the search query terms. The BigFunnel sub-system maintains bloom filter records for up to N documents with the highest static relevancy, where N is currently between 10K and 20K documents 
Additionally, the Filter table is involved in the process of reading POIs corresponding to items in the table, generating PostingLists, and cleaning up the Filter and LargePOI tables as part of the system's maintenance. The size of the Filter table is monitored to ensure it does not negatively impact query latency.
For a more technical understanding, the Filter table allows the system to pivot every X items from filters to term-sharded posting list index, which is crucial for handling large volumes of data and ensuring efficient query processing . The table's design and implementation are such that it supports the system's scalability and performance optimization efforts.

The innovation that was brought in 2015 was to leverage the **search technology from Bing** called BitFunnel (later **BigFunnel**) and co-locate the index along with the data and to leverage bit vector and inverted index to power search. The fresh items in the index were indexed on a bit vector and the older items were indexed in to inverted index. The concept of a per object index (POI) was introduced to prevent reindexing. The inverted index was stored in a table (filter table) in store along with the data. ([BigFunnelTechTalkJune2019](https://microsoft.sharepoint.com/:p:/r/teams/BFExE/_layouts/15/Doc.aspx?sourcedoc=%7B1DAEE522-00D5-4EC9-8433-7A6C6505415E%7D&file=BigFunnelTechTalkJune2019.pptx&action=edit&mobileredirect=true&DefaultItemOpen=1)). The index moved with the data making it more efficient and agile.

hybrid index (bloom filter & post listing)

- [BigFunnel Architecture Overview](https://microsoft-my.sharepoint-df.com/:w:/r/personal/nareshs_microsoft_com/_layouts/15/WopiFrame.aspx?sourcedoc=%7B8601DC9D-08EF-41AA-88B2-1DBDD6D023C6%7D&file=Bigfunnel%20Architecture%20Overview.docx&action=default&xsdata=MDV8MDF8fDc5NmUxN2JhNWNhMjRhZmFjOTkxMDhkYmNlZmNkZDk2fDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2MzgzMzEzNTc2NDc5NDA2MjV8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZUa1JWTlU1Nlp6Rk5WMDEwVFZSbk1GcHBNREJQUkdzMFRGZEdhMDVIUlhSYVZHTXhUbGRhYWsxNlZYZFBSR3Q1UUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE5qazNOVE00T1RRME5qVXp8ZWM4YTliMWVkOGRjNDQ4ZWM5OTEwOGRiY2VmY2RkOTZ8YWZhODFkMmI4YjgwNGVlZGFmMGE4NTYwN2RjMzkxNGI%3D&sdata=emVSeDk5eE9hQjNtWUp0SURmc2lFT0pQUnJuYks5N2xTekc4T2s1MlVhMD0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Cbinweiwu%40microsoft.com "https://microsoft-my.sharepoint-df.com/:w:/r/personal/nareshs_microsoft_com/_layouts/15/wopiframe.aspx?sourcedoc=%7b8601dc9d-08ef-41aa-88b2-1dbdd6d023c6%7d&file=bigfunnel%20architecture%20overview.docx&action=default&xsdata=mdv8mdf8fdc5nmuxn2jhnwnhmjrhzmfjotkxmdhkymnlzmnkzdk2fdcyzjk4ogjmodzmmtqxywy5mwfimmq3y2qwmtfkyjq3fdb8mhw2mzgzmzezntc2ndc5nda2mjv8vw5rbm93bnxwr1zoylhovfpxtjfjbwwwzvzobgnuwnbzmly4zxlkv0lqb2lnqzr3tgpbd01eqwlmq0prswpvavyybhvneklptenkqlrpstzjazkwyudweulpd2lwmvfpt2pfegzrpt18mxxmmk5vwvhsekx6rtvpbtfswlhscgjtzgzua1jwtlu1nlp6rk5wmdewvfzsbk1gchbnrejqukdzmfrgzedhmdviulhsyvzhtxhubgrhywsxnlzyzfbsr3q1uuhsb2ntvmhaqzuytwk5dfpytnpzv2rsy3k4ee5qaznove00t1rrme5qvxp8zwm4ytlimwvkogrjndq4zwm5otewogriy2vmy2rkotz8ywzhodfkmmi4yjgwngvlzgfmmge4ntywn2rjmzkxngi%3d&sdata=emvsedk5ee9hqjntwup0surmc2lft0pqunjuyks5n2xtekc4t2s1mlvhmd0%3d&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2cbinweiwu%40microsoft.com")
    - Naresh’s early day architecture overview
    -
- [The BigFunnel Journey](https://microsoft.sharepoint-df.com/:w:/t/SubstrateNews/EWeOTvxQf51IkW3nSAjrTdcBCv65uYdPmLiH8jYnaI4qVQ?e=1sukiu&wdLOR=c9BAB8015-D3A8-4E92-B3BD-8AA6C3589723&xsdata=MDV8MDF8fDc5NmUxN2JhNWNhMjRhZmFjOTkxMDhkYmNlZmNkZDk2fDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2MzgzMzEzNTc2NDc5NDA2MjV8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZUa1JWTlU1Nlp6Rk5WMDEwVFZSbk1GcHBNREJQUkdzMFRGZEdhMDVIUlhSYVZHTXhUbGRhYWsxNlZYZFBSR3Q1UUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE5qazNOVE00T1RRME5qVXp8ZWM4YTliMWVkOGRjNDQ4ZWM5OTEwOGRiY2VmY2RkOTZ8YWZhODFkMmI4YjgwNGVlZGFmMGE4NTYwN2RjMzkxNGI%3D&sdata=M0Z4dUZRdjNjZFdhckJ1ZjY0ZmZyUUtlOU8wd3dvSG44aUtKYmp3cGlKTT0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Cbinweiwu%40microsoft.com "https://microsoft.sharepoint-df.com/:w:/t/substratenews/eweotvxqf51ikw3nsajrtdcbcv65uydpmlih8jynai4qvq?e=1sukiu&wdlor=c9bab8015-d3a8-4e92-b3bd-8aa6c3589723&xsdata=mdv8mdf8fdc5nmuxn2jhnwnhmjrhzmfjotkxmdhkymnlzmnkzdk2fdcyzjk4ogjmodzmmtqxywy5mwfimmq3y2qwmtfkyjq3fdb8mhw2mzgzmzezntc2ndc5nda2mjv8vw5rbm93bnxwr1zoylhovfpxtjfjbwwwzvzobgnuwnbzmly4zxlkv0lqb2lnqzr3tgpbd01eqwlmq0prswpvavyybhvneklptenkqlrpstzjazkwyudweulpd2lwmvfpt2pfegzrpt18mxxmmk5vwvhsekx6rtvpbtfswlhscgjtzgzua1jwtlu1nlp6rk5wmdewvfzsbk1gchbnrejqukdzmfrgzedhmdviulhsyvzhtxhubgrhywsxnlzyzfbsr3q1uuhsb2ntvmhaqzuytwk5dfpytnpzv2rsy3k4ee5qaznove00t1rrme5qvxp8zwm4ytlimwvkogrjndq4zwm5otewogriy2vmy2rkotz8ywzhodfkmmi4yjgwngvlzgfmmge4ntywn2rjmzkxngi%3d&sdata=m0z4duzrdjnjzfdhckj1zjy0zmzyuutlou8wd3dvsg44autkymp3cglktt0%3d&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2cbinweiwu%40microsoft.com")
    - Ship mail in 4/2021 when BigFunnel fully enabled in Substrate

- [BigFunnel Overview Talk](https://microsoft.sharepoint.com/teams/msai/_layouts/15/stream.aspx?id=%2Fteams%2Fmsai%2FShared%20Documents%2FBootcamp%202020%2FRecordings%2FDay%202%20Recordings%2FBig%20Funnel%20%2D%20Elan%20Zhou%2Emp4&ga=1 "https://microsoft.sharepoint.com/teams/msai/_layouts/15/stream.aspx?id=%2fteams%2fmsai%2fshared%20documents%2fbootcamp%202020%2frecordings%2fday%202%20recordings%2fbig%20funnel%20%2d%20elan%20zhou%2emp4&ga=1")
    - MSAI bootcamp talk (30min)
universal POI (uPOI, uncompressed)
compressed POI (cPOI)

- [Part 7 - Introduction to BigFunnel.mp4](https://microsoft.sharepoint.com/teams/greenland/_layouts/15/stream.aspx?id=%2Fteams%2Fgreenland%2FSOX4Substrate%20Knowledge%20Sharing%2FSessions%2C%20Recordings%20and%20Material%2FPart%207%20%2D%20Introduction%20to%20BigFunnel%2FPart%207%20%2D%20Introduction%20to%20BigFunnel%2Emp4&referrer=StreamSearchPage%2EWeb&referrerScenario=Search%2DStream%2DAll%2EView%2E5e9726aa%2D8e88%2D92ae%2Dda11%2D83fa269f7ed9 "https://microsoft.sharepoint.com/teams/greenland/_layouts/15/stream.aspx?id=%2fteams%2fgreenland%2fsox4substrate%20knowledge%20sharing%2fsessions%2c%20recordings%20and%20material%2fpart%207%20%2d%20introduction%20to%20bigfunnel%2fpart%207%20%2d%20introduction%20to%20bigfunnel%2emp4&referrer=streamsearchpage%2eweb&referrerscenario=search%2dstream%2dall%2eview%2e5e9726aa%2d8e88%2d92ae%2dda11%2d83fa269f7ed9")
    - Another bootcamp talk in 2021

Language detection
Word break (may have difficulty if the doc contains multiple languages)
Document Signature - used for SPO collapsing (remove docs from the result set based on the CollapseSpecification syntax)
Create uPOI - token normalization

Posting List, Posting List maintenance is to remove the items from BF filter table and ingest them into Posting List. When BF filter table goes big(ex, the recrawling we are doing), the search latency goes worse deeply.
Unlike the Filter table, the PL table is optional and is used only for large shards; specifically, shards that contain more than the maximum number of documents that can be maintained in the Filter table. At the current maximum of 20K Filters, less than 5% of all the shards in the service will require the posting-list table
Post List: inverted index. Term -> List of (docid, wordposition)

3 paths: inline / EBA (delayed) / TBA (retry)

# Bestla

[Bestla - M365 Generational Search Index.docx](https://microsoft.sharepoint.com/:w:/t/BFExE/Eb7I6FJn1lJPgoQoJYzuGUQBWDUCIATEmjrqA8w-SK7IXg?e=LU3ZPn)
Vova, BF, Mengdong or Christoffer
[[Mimir]]: stream innovation

# People

Zhe Geng
Lei Bian
Will Liu
Lucky
Arif
Michael Janelle-Montcalm
